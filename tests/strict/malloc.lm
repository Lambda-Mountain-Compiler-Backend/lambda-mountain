
import STDLIB/default-instruction-set.lm;
import STDLIB/default-primitives.lm;
import STDLIB/default-rules.lm;

type S (SNil)
     | (SAtom( U8[] ))
     | (SCons( S[] , S[] ))
     | (SPointer( ?[] ));

close := λ(: x S). (: (tail(
   ()
   (let dst (as
      (malloc(sizeof S))
      S[]
   ))
   (as dst S[])
)) S[]);

malloc := λ (: sz U64) . (: (tail(
   ()
   (as 0u64 '?[])
)) '?[]);
