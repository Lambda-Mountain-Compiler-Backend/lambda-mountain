
import STDLIB/default-instruction-set.lm;
import STDLIB/default-primitives.lm;
import STDLIB/default-stdlib.lm;
import STDLIB/default-rules.lm;

type Used Used | Unused | Tail | Return;

type UPair (UPair( Used , Used ));

== := λ(: lu Used)(: ru Used). (: (tail(
   (let r 0_u64)
   (match (UPair( lu ru )) (
      ()
      ( (UPair( Used Used )) (set r 1_u64) )
#      ( (UPair( Unused Unused )) (set r 1_u64) )
#      ( (UPair( Tail Tail )) (set r 1_u64) )
#      ( (UPair( Return Return )) (set r 1_u64) )
      ( _ () )
   ))
   r
)) U64);

main := λ. (: (tail(
   (let used Used)
   (if (==( used Used )) (
      (print 'Used\n_s)
   ) (
      (print 'Unused\n_s)
   ))
   (let unused Unused)
   (if (==( unused Used )) (
      (print 'Used\n_s)
   ) (
      (print 'Unused\n_s)
   ))
   (let tl Unused)
   (if (==( tl Used )) (
      (print 'Used\n_s)
   ) (
      (print 'Unused\n_s)
   ))
   (let rt Unused)
   (if (==( rt Used )) (
      (print 'Used\n_s)
   ) (
      (print 'Unused\n_s)
   ))
)) Nil);
